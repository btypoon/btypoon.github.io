<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>My note</title>
  </head>

  <body>
    <main>
      <h1>
        Standard Operating Procedure: Management and Troubleshooting Guide for
        the EdUHK Physics Laboratory's Server
      </h1>
      <p class="lead">
        This document serves as a manual for the administration and maintenance
        of the EdUHK Physics Laboratory's Server. It provides instructions for
        accessing and operating the server, outlines current unresolved issues,
        and documents historical problems with its step-by-step solutions. It is
        designed to ensure operational consistency, facilitate troubleshooting,
        and support continuity for future system administrators.
      </p>
      <hr />
      <h1>Table of content</h1>
      <figure class="toc">
        <ol>
          <li><a href="#cluster_architecture">Cluster architecture </a></li>
          <li><a href="#booting_sequence">Booting Sequence </a></li>
          <li>
            <a href="#connect_to_the_server">Connect to the server </a>
          </li>
          <li><a href="#new_user">Adding new user </a></li>
          <li><a href="#list_format">Long format listing ls -l </a></li>
          <li><a href="#etc_groups">/etc/groups </a></li>
          <li>
            <a href="#problem1">
              Problem 1: Looking for a faster way to add new user on all
              computers
            </a>
          </li>
          <li>
            <a href="#problem2">
              Problem 2: Unable to create or modify files in all Slave computers
              for new user
              <ol class="sub-toc">
                <li><a href="#9.1"> Located Cause </a></li>
                <li><a href="#9.2"> Suggested solution </a></li>
                <li>
                  <a href="#9.3">
                    New problem: Different group id for same user across all
                    computers
                  </a>
                </li>
              </ol>
            </a>
          </li>
          <li>
            <a href="#problem3">
              Problem3: Unable to run python program on ther server
            </a>
          </li>
          <li>
            <a href="#problem4">
              Problem 4: Security reported three critical vulnerabilities
            </a>
            <ol class="sub-toc">
              <li>
                <a href="#problem4.1">
                  First Vulnerability - Canonical Ubuntu Linux SEoL (16.04.x) -
                  Critical Severity
                </a>
                <ol class="sub-toc">
                  <li>
                    <a href="#problem4.1.1"
                      >Problem 4.1.1 - Outdated Graphic Driver
                    </a>
                  </li>
                  <li>
                    <a href="#problem4.1.2"
                      >Problem 4.1.2 - "DPKG" packages error</a
                    >
                  </li>
                  <li>
                    <a href="#problem4.1.3"
                      >Problem 4.1.3 - Obsolete PostgreSQL version 9.5</a
                    >
                  </li>
                  <li>
                    <a href="#problem4.1.4"
                      >Problem 4.1.4 - No development version of an LTS
                      available
                    </a>
                  </li>
                </ol>
              </li>
              <li>
                <a href="#problem4.2">
                  Second Vulnerability - SSH Terrapin Prefix Truncation Weakness
                  - High Severity</a
                >
                <ol class="sub-toc">
                  <li>
                    <a href="#problem4.2.1">Problem 4.2.1 - First scan</a>
                  </li>
                  <li>
                    <a href="#problem4.2.2">Problem 4.2.2 - Second scan</a>
                  </li>
                </ol>
              </li>
              <li>
                <a href="#problem4.3">
                  Third Vulnerability - ICMP Timestamp Request Remote Date
                  Disclosure - Low Severity
                </a>
              </li>
            </ol>
          </li>
          <li>
            <a href="#problem5"> Problem 5: SSH Connection failure </a>
            <ol class="sub-toc">
              <li><a href="#12.1"> Mismatch between public IPs </a></li>
              <li><a href="#12.2"> Cause and Replication steps </a></li>
              <li><a href="#12.3"> Static IP address </a></li>
            </ol>
          </li>
          <li>
            <a href="#problem6">
              Problem 6: <span class="inline">ssh hostname</span> Hostname
              unreachable
            </a>
          </li>
          <li>
            <a href="#direct_reinstall">
              Final Decision: Direct Reinstallation of Ubuntu 24.04 LTS
            </a>
          </li>
        </ol>
      </figure>
      <hr />
      <section>
        <h2 id="cluster_architecture">
          Cluster architecture <br />
          <span class="datetime"> 10-Auguest-2023 </span>
        </h2>
        <p>
          There are the seven computers in our server cluster. Their hostname
          are listed below:
        </p>
        <ol>
          <li>bill01</li>
          <li>master</li>
          <li>slave1</li>
          <li>slave2</li>
          <li>slave3</li>
          <li>slave4</li>
          <li>slave5</li>
        </ol>
        <p>
          Sun Grid Engine is used for job scheduling in our server. To install
          Sun Grid Engine, use:

          <span class="command">
            sudo apt-get install gridengine-client gridengine-execute
          </span>
          Set the hostname: to bill_cluster.
        </p>
      </section>
      <section>
        <h2 id="booting_sequence">
          Booting Sequence <br />
          <span class="datetime"> 10-Auguest-2023 </span>
        </h2>
        <p>
          For some reason, the computer <em>"slave4"</em> require special steps
          in order to be booted successfully. When you face "The Red Screen of
          Death", follow these steps:
        </p>
        <ol>
          <li>Press F11 to go into BIOS while booting</li>
          <li>Change the booting mode to UEFI</li>
          <li>Save and reboot</li>
        </ol>
      </section>
      <section>
        <h2 id="connect_to_the_server">
          Connect to the server <br />
          <span class="datetime"> 10-Auguest-2023 </span>
        </h2>
        <p>
          To connect to the server, you must first connected to the university
          intranet. You may use either:
        </p>
        <ul>
          <li>Wifi <span class="inline">EdUHK</span></li>
          <li>Wifi <span class="inline">IoT</span></li>
          <li>Wired university computer</li>
          <li>EdUHK VPN</li>
        </ul>
        <p>
          Use any ssh software of your choice such as
          <i>PuTTY</i> or window terminal. You can connect to either of the
          following IP addresses via <span class="inline">ssh</span> command:
        </p>
        <ul>
          <li><span class="inline">ssh phys.eduhk.hk</span></li>
          <li><span class="inline">ssh phys.ied.edu.hk</span></li>
          <li><span class="inline">ssh 175.159.131.248</span></li>
        </ul>
        <p>
          Enter your username and password when prompted. A quick way to connect
          the server with a specific username is to use
          <span class="inline">ssh username@IP</span>
        </p>
        <p>
          When connected successfully, you will be greeted by the following
          messages.
        </p>
        <pre><code class="language-bash">
"login as: username
username@phys.eduhk.hk's password:
Welcome to Ubuntu 16.04.2 LTS (GNU/Linux 4.8.0-36-generic x86_64)

 * Documentation:  https://help.ubuntu.com
 * Management:     https://landscape.canonical.com
 * Support:        https://ubuntu.com/advantage

Last login: Week Month Day Time Year from IP_address
username@bill01:~$"
          </code></pre>
        <p>
          The entrance point of the server is <i>bill01</i>. To connect to any
          other six computers, type the command
          <span class="inline">ssh hostname</span> with the hostname of the
          other computer.
        </p>
        <p>To get administrative privileges, use the following account:</p>
        <ul>
          <li>username: bill</li>
          <li>username: btypoon</li>
          <li>password: billyeung</li>
        </ul>
      </section>

      <section>
        <h2 id="new_user">
          Adding new user <br />
          <span class="datetime"> 10-Auguest-2023 </span>
        </h2>
        <p>
          To Add a new user, use
          <span class="inline">sudo adduser username</span> with administrative
          privileges. Referring to the
          <a
            href="https://manpages.ubuntu.com/manpages/xenial/man8/adduser.8.html"
            >documentation</a
          >, one may also use
          <span class="inline">sudo adduser username group</span>
        </p>
        <p>Repeat the above command for all machines</p>
        <figure class="text-center">
          <blockquote
            class="blockquote1"
            cite="https://manpages.ubuntu.com/manpages/xenial/man8/adduser.8.html"
          >
            <p style="font-style: italic">
              If called with two non-option arguments, adduser will add an
              existing user to an existing group.
            </p>
          </blockquote>
          <figcaption class="blockquote-footer">
            <em>ubuntu manual adduser</em>
          </figcaption>
        </figure>
        <p>
          As of 30/6/2023, the file in
          <span class="inline">/etc/passwd</span> read:
        </p>
        <pre><code class="language-bash">
#########################################################
root:x:0:0:root:/root:/bin/bash
daemon:x:1:1:daemon:/usr/sbin:/usr/sbin/nologin
bin:x:2:2:bin:/bin:/usr/sbin/nologin
sys:x:3:3:sys:/dev:/usr/sbin/nologin
sync:x:4:65534:sync:/bin:/bin/sync
games:x:5:60:games:/usr/games:/usr/sbin/nologin
man:x:6:12:man:/var/cache/man:/usr/sbin/nologin
lp:x:7:7:lp:/var/spool/lpd:/usr/sbin/nologin
mail:x:8:8:mail:/var/mail:/usr/sbin/nologin
news:x:9:9:news:/var/spool/news:/usr/sbin/nologin
uucp:x:10:10:uucp:/var/spool/uucp:/usr/sbin/nologin
proxy:x:13:13:proxy:/bin:/usr/sbin/nologin
www-data:x:33:33:www-data:/var/www:/usr/sbin/nologin
backup:x:34:34:backup:/var/backups:/usr/sbin/nologin
list:x:38:38:Mailing List Manager:/var/list:/usr/sbin/nologin
irc:x:39:39:ircd:/var/run/ircd:/usr/sbin/nologin
gnats:x:41:41:Gnats Bug-Reporting System (admin):/var/lib/gnats:/usr/sbin/nologin
nobody:x:65534:65534:nobody:/nonexistent:/usr/sbin/nologin
systemd-timesync:x:100:102:systemd Time Synchronization,,,:/run/systemd:/bin/false
systemd-network:x:101:103:systemd Network Management,,,:/run/systemd/netif:/bin/false
systemd-resolve:x:102:104:systemd Resolver,,,:/run/systemd/resolve:/bin/false
systemd-bus-proxy:x:103:105:systemd Bus Proxy,,,:/run/systemd:/bin/false
syslog:x:104:108::/home/syslog:/bin/false
_apt:x:105:65534::/nonexistent:/bin/false
messagebus:x:106:110::/var/run/dbus:/bin/false
uuidd:x:107:111::/run/uuidd:/bin/false
lightdm:x:108:114:Light Display Manager:/var/lib/lightdm:/bin/false
whoopsie:x:109:116::/nonexistent:/bin/false
avahi-autoipd:x:110:119:Avahi autoip daemon,,,:/var/lib/avahi-autoipd:/bin/false
avahi:x:111:120:Avahi mDNS daemon,,,:/var/run/avahi-daemon:/bin/false
dnsmasq:x:112:65534:dnsmasq,,,:/var/lib/misc:/bin/false
colord:x:113:123:colord colour management daemon,,,:/var/lib/colord:/bin/false
speech-dispatcher:x:114:29:Speech Dispatcher,,,:/var/run/speech-dispatcher:/bin/false
hplip:x:115:7:HPLIP system user,,,:/var/run/hplip:/bin/false
kernoops:x:116:65534:Kernel Oops Tracking Daemon,,,:/:/bin/false
pulse:x:117:124:PulseAudio daemon,,,:/var/run/pulse:/bin/false
rtkit:x:118:126:RealtimeKit,,,:/proc:/bin/false
saned:x:119:127::/var/lib/saned:/bin/false
usbmux:x:120:46:usbmux daemon,,,:/var/lib/usbmux:/bin/false
bill:x:1000:1000:bill01,,,:/home/bill:/bin/bash
postfix:x:121:129::/var/spool/postfix:/bin/false
sgeadmin:x:122:131::/var/lib/gridengine:/bin/false
sshd:x:123:65534::/var/run/sshd:/usr/sbin/nologin
hadoopuser:x:1001:1001:,,,:/home/hadoopuser:/bin/bash
testuser:x:1002:1002:,,,:/home/testuser:/bin/bash
jacky:x:1003:1003:,,,:/home/jacky:/bin/bash
takshing:x:1004:1004:,,,:/home/takshing:/bin/bash
cheong:x:1005:1005:,,,:/home/cheong:/bin/bash
lim:x:1006:1006:,,,:/home/lim:/bin/bash
curtis:x:1007:1007:,,,:/home/curtis:/bin/bash
statd:x:1008:1008:,,,:/home/statd:/bin/bash
bil:x:1009:1009:,,,:/home/bil:/bin/bash
kcchoi:x:1010:1010:,,,:/home/kcchoi:/bin/bash
roy:x:1011:1011:,,,:/home/roy:/bin/bash
leo:x:1012:1012:,,,:/home/leo:/bin/bash
intern:x:1013:1013:,,,:/home/intern:/bin/bash
william:x:1014:1014:,,,:/home/william:/bin/bash
brian:x:1015:1015:,,,:/home/brian:/bin/bash
paul:x:1016:1016:,,,:/home/paul:/bin/bash
btypoon:x:1017:1017:,,,:/home/btypoon:/bin/bash
#########################################################
          </code></pre>
      </section>
      <section>
        <h2 id="list_format">
          Long format listing ls -l <br />
          <span class="datetime"> 10-Auguest-2023 </span>
        </h2>
        <p>
          Using <span class="inline">ls -l</span> to list long format of files.
          The columns coorespond to:
        </p>
        <ol>
          <li>The file type.</li>
          <li>The file permissions.</li>
          <li>Number of hard links to the file.</li>
          <li>File owner.</li>
          <li>File group.</li>
          <li>File size.</li>
          <li>Date and Time.</li>
          <li>File name.</li>
        </ol>
      </section>
      <section>
        <h2 id="etc_groups">
          /etc/groups <br />
          <span class="datetime"> 10-Auguest-2023 </span>
        </h2>
        <p>
          To view all groups, visit
          <span class="inline">/etc/groups</span>. To change the uid or gid of a
          user, use:
          <span class="command">sudo usermod -u uid -g gid username</span> To
          change the gid or group name of a group, use:
          <span class="command"
            >sudo groupmod -g gid -n new_groupName old_groupName</span
          >
        </p>
      </section>
      <section>
        <h2 id="problem1">
          Problem 1: Looking for a faster way to add new user on all computers
          <br />
          <span class="datetime"> 19-Auguest-2023 </span>
        </h2>
        <p>
          Currently, to add a new user, we need to repeats the command
          <span class="inline">sudo adduser</span> in all seven computers. We
          look for solution to add new user on all computer simultaneously.
        </p>
        <p>
          Maybe, there is a way to synchronize the user data on all computers.
          Or one might write a script to automatically create a new user with
          the necessary credential information on all computers in one go
        </p>
      </section>
      <section>
        <h2 id="problem2">
          Problem 2: Unable to create or modify files in all Slave computers for
          new user <br /><span class="datetime">5-July-2023</span>
        </h2>
        <p>
          Our new user Thomas Ho cannot run program or make any changes in all
          slaves computers but bill01. Older account does not have this problem
        </p>
        <h3 id="9.1">Located Cause</h3>
        <p>
          The problem was that the system treated the user from other host
          (slave1-5) as "other user" instead of "owner" although they have the
          same username. Therefore, after I allowed write permission for "other
          user" in the directory, the problem was solved. However, "other user"
          including user other then the user with the same name as the owner can
          also modify the file inside now
        </p>
        <h3 id="9.2">Suggested solution</h3>
        <ol>
          <li>
            Giving him admin privilege such that he can use sudo command.
            Downside was that he gain access to other admin command
          </li>
          <li>
            Enable write permission for all users in Thomas's home folder.
            Downside was that every other user can write file to his home
            folder.
          </li>
          <li>
            Another solution is to allow specific group of user to access the
            folder by their group ID. However, as I dig through the file, I
            found another problem. The group id for the groups of same name in
            bill01 and slave1-5 computers were different.
          </li>
        </ol>
        <h3 id="9.3">
          New problem: Different group id for same user across all computers
        </h3>
        <img width="300" src="image\problem1.jpg" alt="" />
        <figcaption>
          The image display the defined groups in bill01 (left), slave1(middle)
          and slave2(right) from /etc/groups.
        </figcaption>
        <p>
          The word represents the group name and the number represent the group
          id. Each user was assigned a group id when created. Files recognize
          permitted user by their group id. For example, my group id was 1017 in
          bill01 and 1016 in slave1-5.
        </p>
        <p>
          Since the home folder was created in bill01, it permitted users of
          group id 1017 to write and modify in it. However, my group id was 1016
          in slave's computer. Therefore, even if I allowed write permission for
          the group of ID 1017, I cannot write in my home folder in slave's
          computers . To make it works, I would need to fix the mismatches of
          group id in bill01 and slave1-5. Therefore I suggest simply making the
          user home's folder writable for all user, which is what I did.
        </p>
        <p>
          So, at the end,
          <span style="text-decoration: underline">solution 2 was employed</span
          >.
        </p>
      </section>
      <section>
        <h2 id="problem3">
          Problem3: Unable to run python program on ther server
          <br /><span class="datetime">9-Dec-2023</span>
        </h2>
        <p>
          Another work colleague Nesat wanted to run her python program on the
          physics lab's cluster server, but unabled to do so. Specifically, she
          wanted to install the python packages "Tensorflow", which her program
          rely on, but unsuccessful. This problem remain unresolved. Further
          investigation is required.
        </p>
      </section>

      <section>
        <h2 id="problem4">
          Problem 4: Security reported three critical vulnerabilities
          <br /><span class="datetime">11-Jul-2025</span>
        </h2>
        <p>
          According to the Tenable Security Report provided by the OCIO, three
          vulnerabilities had been identified on the Physics Laboratory's
          Server:
        </p>
        <ol>
          <li>Canonical Ubuntu Linux SEoL (16.04.x) - Critical Severity</li>
          <li>
            SSH Terrapin Prefix Truncation Weakness (CVE-2023-48795) - High
            Severity
          </li>
          <li>ICMP Timestamp Request Remote Date Disclosure - Low Severity</li>
        </ol>
        <section>
          <h3 id="problem4.1">
            First vulnerability - Canonical Ubuntu Linux SEoL (16.04.x) -
            Critical Severity
          </h3>
          <p>
            Regarding the first critical vulnerability, our server was running
            Ubuntu version 16.04, which reached its end-of-life in 2021 and was
            no longer supported by the Official. Upgrading the operating system
            to a supported and up-to-date version will effectively resolve this
            issue.
          </p>
          <p>
            To reserve all the user data and system settings, we desired to not
            do a comeplete erase and reinstallation of the OS. So, we decided to
            upgrade the OS using the system upgrader.
          </p>
          <p>
            However, Ubuntu does not support a direct upgrade from version 16.04
            to the latest release, 24.04. Instead, the upgrade must be performed
            incrementally from 16.04 → 18.04 → 20.04 → 22.04 → 24.04.
          </p>
          <p>
            For each upgrade step, the following commands should be executed:
          </p>
          <pre><code class="language-bash">
sudo apt update
sudo apt dist-upgrade
sudo reboot
sudo do-release-upgrade
          </code></pre>
          <p>
            The upgrade process must be repeated for each of the seven computers
            in our server cluster, marking a total of 28 OS upgrades. This made
            the overall effort very time-consuming.
          </p>
          <p>
            To make the process effective, the following two shell script were
            written and to be executed in sequence on each of the OS upgrades.
          </p>
          <pre><b>ubuntu_apt-upgrade.sh</b><code class="language-bash">
#!/bin/bash

# Exit if any command fails
set -e
# Ensure the script is run as root
if [ "$EUID" -ne 0 ]; then
  echo "❌ Please run as root or with sudo"
  exit 1
fi

# Ubuntu Upgrade Automation Script: 16.04 → 24.04 LTS
function upgrade_stage() {
    echo "======================================"
    echo "Preparing system for release upgrade from Ubuntu $1"
    echo "======================================"
    read -p "This script will update your system and drivers. Press Enter to continue, or Ctrl+C to cancel."


    echo "======================================"
    echo "Step 1: Updating package list..."
    echo "======================================"
    apt update

    echo "======================================"
    echo "Step 2: Performing dist-upgrade..."
    echo "======================================"
    apt dist-upgrade -y


    echo "======================================"
    echo "Step 3: Removing unused packages."
    echo "======================================"
    apt autoremove -y


    echo "======================================"
    echo "Step 4: Checking for recommended drivers..."
    echo "======================================"
    ubuntu-drivers devices


    echo "======================================"
    echo "Step 5: Ready to install recommended drivers."
    echo "======================================"
    read -p "Press Enter to proceed, or Ctrl+C to cancel."
    ubuntu-drivers autoinstall

    echo "======================================"
    echo "Step 6: Rebooting system..."
    echo "======================================"
    read -p "Press Enter to reboot now, or Ctrl+C to cancel."
    reboot
}



# Detect current version
#using /etc/os-release instead of lsb_release for newer OS
if [[ -f /etc/os-release ]]; then
    current_version=$(grep "^VERSION_ID=" /etc/os-release | cut -d '"' -f 2)
else
    echo "Cannot detect OS version. /etc/os-release not found."
    exit 1
fi

upgrade_stage "$current_version"
          </code></pre>
          <pre><b>ubuntu_do-release-upgrade.sh</b><code class="language-bash">
#!/bin/bash

# Exit if any command fails
set -e
# Ensure the script is run as root
if [ "$EUID" -ne 0 ]; then
  echo "❌ Please run as root or with sudo"
  exit 1
fi

# Ubuntu Upgrade Automation Script: 16.04 → 24.04 LTS
function release_upgrade() {
    echo "======================================"
    echo "OS upgrading from Ubuntu $1"
    echo "Performing release upgrade..."
    echo "======================================"

    if do-release-upgrade -f DistUpgradeViewNonInteractive; then
        echo "Standard release upgrade succeeded."
    else
        echo "Standard upgrade failed. Trying development release upgrade..."
        do-release-upgrade -d -f DistUpgradeViewNonInteractive
    fi

    echo "Release upgrade completed. Please reboot and re-run the script to continue."
    read -p "Press Enter to reboot now."
    reboot
}


# Detect current version 
#using /etc/os-release instead of lsb_release for newer OS
if [[ -f /etc/os-release ]]; then
    current_version=$(grep "^VERSION_ID=" /etc/os-release | cut -d '"' -f 2)
else
    echo "Cannot detect OS version. /etc/os-release not found."
    exit 1
fi


release_upgrade "$current_version"
          </code></pre>
          <p>
            To check the current OS version, one may use the following commands
            for version before 18.04:
            <span class="command">lsb_release -a</span>
            and after 20.04:
            <span class="command">cat /etc/os/release</span>
          </p>
          <section>
            <h4 id="problem4.1.1">Problem 4.1.1 - Outdated Graphic Driver</h4>
            <p>
              During the upgrade process of computers <i>Bill01</i> and
              <i>master</i>, the display output was lost due to outdated
              graphics drivers that were incompatible with the newer version of
              Ubuntu.
            </p>
            <p>To resolve this issue, the following steps were taken:</p>
            <ol>
              <li>
                <b>Identifying the Graphics Card</b>
                <p>
                  The following command was ran to determine the video card
                  installed on the system:
                  <span class="command">sudo lshw -c video</span>
                </p>
              </li>
              <li>
                <b>Installing Driver Management Module (if missing)</b>
                <p>
                  For machine that do not have ubuntu-drivers utility installed,
                  we ran:
                  <span class="command"
                    >sudo apt install ubuntu-drivers-common</span
                  >
                </p>
              </li>
              <li>
                <b>Check for Available Drivers</b>
                <p>
                  Using the command below, we listed any new and available
                  drivers:
                  <span class="command">ubuntu-drivers devices</span>
                </p>
              </li>
              <li>
                <b>Installing new Drivers</b>
                <p>
                  To install the new graphics drivers, we ran:
                  <span class="command">sudo ubuntu-drivers autoinstall</span>
                </p>
              </li>
              <li>
                <b>Reboot the System</b>
                <p>
                  After installation, we rebooted the system to apply the
                  changes:<span class="command">sudo reboot</span>
                </p>
              </li>
            </ol>
            <p>
              Afterwards, the display functionality was restored and the upgrade
              process can be continued.
            </p>
          </section>
          <section>
            <h4 id="problem4.1.2">Problem 4.1.2 - "DPKG" packages error</h4>
            <p>
              During the upgrade process of computers <i>Slave1-5</i>, all
              encountered the error:
              <span class="inline"
                >"Sub-process /usr/bin/dpkg returned an error code (1)"</span
              >, preventing them from being upgradable.
            </p>
            <p>
              Extensive testing showed the issue stemmed from many conflicting
              and corrupted packages presented on each of the affected
              computers. Resolving the problem involved either removing or
              reinstalling the problematic packages, which successfully restored
              the upgrade functionality.
            </p>
            <p>
              Afterward, type command
              <span class="command">sudo dpkg --configure -a </span> to fix
              package installation issue
            </p>
          </section>
          <section>
            <h4 id="problem4.1.3">
              Problem 4.1.3 - Obsolete PostgreSQL version 9.5
              <br /><span class="datetime">22-July-2025</span>
            </h4>
            <p>
              During the upgrade process of all seven computers, a prompt
              displaying the message "Obsolete major version 9.5" appeared,
              which halted the upgrade.
            </p>
            <p>
              After consulting with staff and the supervisor, we determined that
              the associated package is no longer in use. Therefore, we opted to
              uninstall the package rather than invest time in resolving
              potential conflicts or upgrading its version. To find and list all
              the PostgreSQL packages, we ran:
              <span class="command">dpkg -l | grep postgresql</span>
            </p>
            <p>
              Following the uninstallation of the PostgreSQL package, the OS
              upgrade processes were resumed.
            </p>
          </section>
          <section>
            <h4 id="problem4.1.4">
              Problem 4.1.4 - No development version of an LTS available
              <br /><span class="datetime">22-July-2025</span>
            </h4>

            <p>
              During the OS upgrade from version 18.04 to 20.04 on the computers
              "slave2", "slave3", and "slave4", all three machines failed to
              execute the command command
              <span class="inline">sudo do-release-upgrade</span>. Each reported
              the same error.
            </p>
            <pre><code class="language-bash">
"Checking for a new Ubuntu release
Failed to connect to https://changelogs.ubuntu.com/meta-release-lts-development.
Check your Internet connection or proxy settings
There is no development version of an LTS available."
            </code></pre>
            <p>
              After extensive research, we discovered that the URLs used by the
              update manager to access the repository of available Ubuntu
              releases were no longer functioning.
            </p>
            <p>
              To resolve this, we manually modified the URLs by running:
              <span class="command"
                >sudo nano /etc/update-manager/meta-release</span
              >
              and changing <span class="inline">https</span> to
              <span class="inline">http</span>.
            </p>
            <pre><code class="language-bash">  
[METARELEASE]         
URI = http://changelogs.ubuntu.com/meta-release
URI_LTS = http://changelogs.ubuntu.com/meta-release-lts
            </code></pre>
          </section>
        </section>
        <section>
          <h3 id="problem4.2">
            Second vulnerability - SSH Terrapin Prefix Truncation Weakness -
            High Severity
          </h3>
          <section>
            <h4 id="problem4.2.1">Problem 4.2.1 - First scan</h4>
            <p>
              Regarding the second high-severity vulnerability, it was
              identified that the cryptographic algorithms currently utilized by
              our SSH server were considered insecure and potentially
              susceptible to exploitation. Specifically, the following six
              algorithms were flagged:
            </p>
            <ul>
              <li>chacha20-poly1305@openssh.com</li>
              <li>umac-64-etm@openssh.com</li>
              <li>umac-128-etm@openssh.com</li>
              <li>hmac-sha2-256-etm@openssh.com</li>
              <li>hmac-sha2-512-etm@openssh.com</li>
              <li>hmac-sha1-etm@openssh.com</li>
            </ul>
            <p>
              To mitigate this vulnerability, it is recommended to either
              disabled or replaced these algorithms with more secure
              alternatives. Disabling them should be sufficient to resolve the
              issue.
            </p>
            <p>
              To do that, edit the
              <span class="inline">sshd_config</span> file by command

              <span class="command"> sudo nano /etc/ssh/sshd_config </span>
              and append the following code to the end of file
            </p>
            <pre><code class="language-bash">
# Disable Ciphers List
Ciphers -chacha20-poly1305@openssh.com

#Enable MACs List
MACs hmac-sha1,hmac-sha1-96,hmac-sha2-256,hmac-sha2-512,hmac-md5,hmac-md5-96,umac-64@openssh.com,umac-128@openssh.com,hmac-sha1-96-etm@openssh.com,hmac-md5-etm@openssh.com,hmac-md5-96-etm@openssh.com
            </code></pre>
            <p>
              For unknown reason, multiple exclusions was not working. Only the
              first one in the list was disabled. User can still connect via
              other listed MACs algorithm. Therefore, we used explicit inclusion
              list and avoided using exclusion list for MACs.
            </p>
            <pre><code class="language-bash">
# Disable MACs List
MACs -umac-64-etm@openssh.com,-umac-128-etm@openssh.com,-hmac-sha2-256-etm@openssh.com,-hmac-sha2-512-etm@openssh.com,-hmac-sha1-etm@openssh.com
          </code></pre>
            <p>
              To list all available Ciphers and MACs supported by OpenSSH, use
              <span class="inline">ssh -Q mac</span> and
              <span class="inline">ssh -Q cipher</span>
            </p>
            <p>
              To verify the whether the cryptographic algorithms were disabled,
              specify the algorithms used in ssh connection. For example:
              <span class="command"
                >ssh -c chacha20-poly1305@openssh.com user@ip</span
              >
              <span class="command"
                >ssh -m umac-64-etm@openssh.com user@ip</span
              >
            </p>
            <p>
              Implementing these modifications is expected to resolve the second
              high-severity vulnerability.
            </p>
          </section>
          <section>
            <h4 id="problem4.2.2">Problem 4.2.2 - Second scan</h4>
            <p>
              After the correction of the MACs list, a second security scan was
              performed and reported by OCIO. The Tenable security scan reported
              additional insecure MAC algorithms in used, namely:
            </p>
            <ul>
              <li>hmac-md5</li>
              <li>hmac-md5-96</li>
              <li>hmac-md5-96-etm@openssh.com</li>
              <li>hmac-md5-etm@openssh.com</li>
              <li>hmac-sha1-96</li>
              <li>hmac-sha1-96-etm@openssh.com</li>
            </ul>
            <p>
              In response, a list of permitted MAC algorithms in
              <span class="inline">sshd_config</span> was further restricted to
              enhance security.
            </p>
            <pre><code class="language-bash">   
#Enable MACs List
MACs hmac-sha1,hmac-sha2-256,hmac-sha2-512,umac-64@openssh.com,umac-128@openssh.com
            </code></pre>
          </section>
        </section>
        <section>
          <h3 id="problem4.3">
            Third vulnerability - ICMP Timestamp Request Remote Date Disclosure
            - Low Severity
          </h3>
          <p>
            For the third vulnerability, the server maintenance technician
            should Block ICMP Timestamp Requests at the Firewall. Require
            someone familiar with Linus operating systems to access and modify
            the firewall setting.
          </p>
          <p>
            The issue was automatically resolved upon completion of the OS
            upgrade.
          </p>
        </section>
      </section>
      <section>
        <h2 id="problem5">
          Problem 5: SSH Connection failure
          <br /><span class="datetime">11-Jul-2025</span>
        </h2>
        <p>
          While upgrading the Operating system of the server, there was a period
          during which the SSH service became inaccessible. A thorough and
          extensive investigation revealed that, in <i>Bill01</i>, two wired
          network connections were conflicting, resulting in a mismatch between
          the static public IP address provided by OCIO and the dynamic public
          IP address assigned by our router.
        </p>
        <p>
          On every reboot of <i>Bill01</i>, the dynamic public IP address
          override the static public IP. An network reset and override must be
          performed manually. It hints a potential problem that might recur in
          the future. For reference, the steps we took were logged below.
        </p>
        <section>
          <h3 id="12.1">Mismatch between public IPs</h3>
          <p>
            When runing <span class="inline">hostname -I</span> and
            <span class="inline">curl ifconfig.me</span>, different public IPs
            were returned. Our server although connected to the static IP
            network, was not using it as its public IP. Hence, connection via
            static IP, <span class="inline">ssh 175.159.131.248</span>, was not
            working.
          </p>
          <p>
            One may temporarily forward port 22 on the router via its setting
            page at <span class="inline">192.168.1.1</span> with the password
            <span class="inline">billyeung</span>. And enable listening on
            incoming connection from all IPs by editing the
            <span class="inline">sshd_config</span> file:
            <span class="command">sudo nano /etc/ssh/sshd_config</span>
          </p>
          <pre><code class="language-bash">
ListenAddress ::
ListenAddress 0.0.0.0
            </code></pre>
          <p>
            Then, use the dynamic public IP assigned by the router to ssh
            connect the server. As of 10-7-2025, SSH connection was temporarily
            reestablished using the dynamic IP,
            <span class="inline">ssh 175.159.139.164</span>.
          </p>
          <p>
            If the ssh service is still unavailable, one may check and restart
            its status using
            <span class="command">sudo systemctl status ssh</span>
            <span class="command">sudo systemctl restart ssh</span>
          </p>
          <p>
            Check also the firewall to see if connection via port 22 was
            allowed. Allow ssh in the firewall if needed.
            <span class="command">sudo ufw status</span>
            <span class="command">sudo ufw allow ssh</span>
          </p>
          <p>
            This way, one may continue working on the server remotely via the
            dynamic ip address.
          </p>
        </section>
        <section>
          <h3 id="12.2">Cause and Replication steps</h3>
          <figure>
            <img width="450" src="image\cluster\network_setting.webp" alt="" />
            <figcaption>
              (Top) Ethernet <i>enp0s25</i> refers to the static IP network.
              (Bottom) Ethernet <i>ens1</i> refers to the dynamic IP network.
            </figcaption>
          </figure>

          <p>
            Extensive investigation revealed that the computer was connected to
            two different networks. The Ethernet interface
            <i>enp0s25</i> connected the computer <i>bill01</i> to the external
            internet, while the Ethernet interface <i>ens1</i> linked
            <i>bill01</i> to the internal intranet, allowing its communication
            and access with the other six computers.
          </p>
          <p>
            The order in which the network interfaces were connected affected
            the computer’s public IP address. When the network <i>ens1</i> was
            connected first, bill01 use the dynamic public IP address assigned
            by the router as its public IP address. When the network
            <i>enp0s25</i> was connected first, bill01 use the static public IP
            address assigned by OCIO as its public IP address.
          </p>
          <p>
            <b>
              Therefore, we should always click the <i>enp0s25</i> button first,
              then the <i>ens1</i> button secondly.
            </b>
            It was confirmed that the static IP address, the SSH service, and
            the firewall were all functioning correctly. The issue stemmed
            solely from the sequence of network connections, which altered the
            public IP address and led to SSH connection failures.
          </p>
        </section>
        <section>
          <h3 id="12.3">Static IP address</h3>
          <figure>
            <img width="450" src="image/cluster/static-ip.webp" alt="" />
            <figcaption>
              The static public IP, netmask, gateway and DNS provided by OCIO in
              April 2016.
            </figcaption>
          </figure>
          <p>
            Make sure the network interface <i>enp0s25</i> was setup correcly
            using the static IP address provided by OCIO.
          </p>
        </section>
      </section>
      <section>
        <h2 id="problem6">
          Problem 6: <span class="inline">ssh hostname</span>: Hostname
          unreachable <br /><span class="datetime">11-Jul-2025</span>
        </h2>
        <p>
          After OS upgrade or system reboot, the local IP address assigned to
          the computers by our router might changed. Therefore, SSH connection
          between computers like
          <span class="inline">ssh master</span> fails. The system tried to
          refer and connect to the old local IP which no longer exist.
        </p>
        <section>
          <h3>Option 1</h3>
          <p>
            Check the latest local IP on each computer using either command
            <span class="inline">ip a</span>,
            <span class="inline">ifconfig</span> or
            <span class="inline">hostname -I</span>.
          </p>
        </section>
        <section>
          <h3>Option 2</h3>
          <p>
            You may also connect to the router webpage via
            <span class="inline">192.168.1.1</span>, login with the password
            <sudo class="inline">billyeung</sudo> and check the list of local IP
            address.
          </p>
        </section>
        <section>
          <h3>Option 3</h3>
          <p>
            Use <span class="inline">nmap</span> modules to view all the devices
            in the local network. Install the module if needed:
            <span class="command">sudo apt install nmap</span>
          </p>
          <p>
            Then, run the following command to scan the local network. Try to
            locate any new IP and connect to it to check its hostname.
            <span class="command">
              nmap -sn $(hostname -I | awk '{print $1}')/24
            </span>
          </p>
        </section>
        <section>
          <h3>Option 4</h3>
          <p>
            Reassign static local IPs to each of the seven compupters. To do
            that, login our router webpage via
            <span class="inline">192.168.1.1</span> with the password
            <span class="inline">billyeung</span>. Assign each of the seven
            computers with a custom static local IP address.
          </p>
          <figure>
            <img width="450" src="image\cluster\local-ip.webp" alt="" />
            <figcaption>
              On 17-July-2025, new custom static local IP addresses were
              assigned to each of the seven computers.
            </figcaption>
          </figure>
        </section>
        <section>
          <h3>Solution</h3>
          <p>
            Finally, update the file
            <span class="inline">/etc/hosts</span> with the latest local IP
            address corresponding to each computers hostname. Repeat and
            synchronize the file across all seven computers.
          </p>
          <p>
            The file in <span class="inline">/etc/hosts</span> stores the
            hostname and their corresponding IP address.
          </p>
          <ol>
            <li>The files should be the same across all computers.</li>
            <li>
              And the IP should match the assigned local IP by the router.
            </li>
          </ol>
          <p>
            If not, use <span class="inline">sudo nano /etc/hosts</span> to edit
            the file.
          </p>
          <p>As of 30/6/2023, this file in computer <i>master</i>:</p>
          <pre><code class="language-bash">
#########################################################
#127.0.0.1 localhost
#127.0.1.1 bill03
192.168.1.143 master
192.168.1.104 bill01
192.168.1.102 slave1
192.168.1.224 slave2
192.168.1.12 slave3
192.168.1.100 slave4
192.168.1.103 slave5
#175.159.131.248 bill-workstation
#202.45.51.232 master
#202.45.51.231 slave1
# the following lines are desirable for ipv6 capable hosts
::1 ip6-localhost ip6-loopback
fe00::0 ip6-localnet
ff00::0 ip6-mcastprefix
ff02::1 ip6-allnodes
ff02::2 ip6-allrouters
#########################################################
            </code>
          </pre>
          <p>
            As of July 17, 2025, each of the seven computers was assigned a new
            static local IP address. Their hosts files have been updated to
            incorporate these changes accordingly.
          </p>
          <pre>
            <code class="language-bash">
#########################################################
127.0.0.1       localhost
127.0.1.1       this_computer_hostname

# The following lines are desirable for IPv6 capable hosts
::1     ip6-localhost ip6-loopback
fe00::0 ip6-localnet
ff00::0 ip6-mcastprefix
ff02::1 ip6-allnodes
ff02::2 ip6-allrouters
192.168.1.100 bill01
192.168.1.101 slave1
192.168.1.102 slave2
192.168.1.103 slave3
192.168.1.104 slave4
192.168.1.105 slave5
192.168.1.106 master
#########################################################
          </code>
        </pre>
        </section>
      </section>
      <section>
        <h2 id="problem7">
          Bill01: Locked Display Resolution at 640x480 <br /><span
            class="datetime"
            >23-Jul-2025</span
          >
        </h2>
        <p>
          Due to a previous attempt to resolve issues with executing
          <span class="inline">do-release-upgrades</span>, the update manager
          was configured to allow upgrades to non-LTS versions of Ubuntu.
        </p>
        <p>
          Specifically, the setting
          <span class="inline">prompt=lts</span> was changed to
          <span class="inline">prompt=normal</span> in the configuration file
          using the command:
          <span class="command"
            >sudo nano /etc/update-manager/release-upgrades</span
          >
        </p>
        <p>
          This change was not reverted, resulting in the system upgrading to
          Ubuntu 25.04. Since this upgrade, the display on <em>Bill01</em> has
          been locked at a resolution of 640x480.
        </p>
        <p>
          Extensive investigation revealed that the last officially supported
          driver for Bill01's Quadro K420 graphics card is Nvidia 470, which is
          not available in the Ubuntu 25.04 repositories. Ubuntu 25.04 includes
          only Nvidia drivers versions 535 to 575, which do not support the
          Quadro K420.
        </p>
        <p>
          Consequently, command like
          <span class="inline">nvidia-smi</span> failed to communicate with the
          driver, indicating that the Nvidia 470 driver was not loaded or
          active.
        </p>
        <p>
          To resolve this issue, we first purged all Nvidia drivers installed on
          the system with:
          <span class="command">sudo apt purge '^nvidia-.*'</span>
        </p>
        <p>
          Then, we installed the open-source Nouveau graphics driver with:
          <span class="command"
            >sudo apt install xserver-xorg-video-nouveau</span
          >
        </p>
        <p>
          After rebooting the system, the display resolution options were
          restored, allowing for higher display resolutions to be used.
        </p>
      </section>
      <section>
        <h2 id="direct_reinstall">
          Final Decision: Direct Reinstallation of Ubuntu 24.04 LTS
          <br /><span class="datetime">23-Jul-2025</span>
        </h2>
        <p>
          Despite significant efforts to upgrade the operating systems and
          troubleshoot the seven computers through versions 16.04, 18.04, 20.04,
          22.04, and 24.04, the system files remained heavily corrupted, leading
          to persistent issues.
        </p>
        <p>Specifically</p>
        <ul>
          <li>
            <b>Slave1</b>: The GUI was inaccessible. Further investigation
            revealed that the system was in a mixed state of versions 20.04 and
            24.04. As a result, the internal updater continuously requested
            packages for 24.04 while the system was still running 20.04, causing
            errors.
          </li>
          <li>
            <b>Slave2</b>: The GUI was non-functional. The taskbar, menu, and
            "Open Terminal" option via right-click were missing, leaving only
            the background image visible.
          </li>
          <li>
            <b>Slave5</b>: The GUI also appeared broken, with the screen turning
            off and on repeatedly every few seconds.
          </li>
        </ul>

        <p>
          Given these problems, the final decision was to erase the disks of all
          computers expect <em>bill01</em>. And perform a clean reinstallation
          of Ubuntu version 24.04. This approach ensures that all previous data
          and system problems were removed, resulting in fully operational and
          clean systems.
        </p>
        <p>
          To preserve user data such as user accounts, passwords, and system
          settings like static IP configurations, we have decided not to
          reinstall the OS on <em>bill01</em>.
        </p>
        <p>
          To facilitate synchronization and streamline the setup process across
          master and slave1-5 computers, three additional shell scripts, namely
          <span class="inline">ssh_setup.sh</span>,
          <span class="inline">desktop_setup.sh</span> and
          <span class="inline">hostname_setup.sh</span> were written and to be
          executed on all computers.
        </p>

        <pre><b>ssh_setup.sh:</b><code class="language-bash">
#!/bin/bash

# Exit if any command fails
set -e
# Ensure the script is run as root
if [ "$EUID" -ne 0 ]; then
  echo "❌ Please run as root or with sudo"
  exit 1
fi

echo "Set power mode to performance" 
powerprofilesctl set performance
echo "✅ Power mode set to Performance."
	
echo "Installing OpenSSH server..."
apt update
apt install -y openssh-server
echo "✅ OpenSSH installed"

echo "Starting SSH service..."
systemctl start ssh
echo "✅ OpenSSH started"

echo "Enabling SSH service to start on boot..."
systemctl enable ssh
echo "✅ OpenSSH enabled on startup"

echo "Setting up UFW (Uncomplicated Firewall)..."
ufw allow ssh
ufw --force enable
echo "✅ Firewall enabled"

ssh_folder="/home/$SUDO_USER/.ssh"
echo "Removing previous SSH host keys in $ssh_folder"
if [ -f "$ssh_folder/known_hosts" ]; then
rm -f "$ssh_folder/known_hosts"
echo "✅ $ssh_folder/known_hosts file cleared"
else
echo "✅ No Known_hosts file"
fi
if [ -f "$ssh_folder/known_hosts.old" ]; then
rm -f "$ssh_folder/known_hosts.old"
echo "✅ $ssh_folder/known_hosts.old file cleared"
else
echo "✅ No Known_hosts.old file"
fi
echo "✅ SSH and firewall setup complete. 🎉"

echo "Remove insecure Cryptographic Algorithms"
CONFIG_FILE="/etc/ssh/sshd_config"
CIPHERS_LINE="Ciphers -chacha20-poly1305@openssh.com"
MACS_LINE="MACs hmac-sha1,hmac-sha2-256,hmac-sha2-512,umac-64@openssh.com,umac-128@openssh.com"

# Function to check and append if necessary
append_if_missing() {
    local line="$1"
    local comment="$2"
    if ! grep -Fxq "$line" "$CONFIG_FILE"; then
        echo "" >> "$CONFIG_FILE"
        echo "# $comment" >> "$CONFIG_FILE"
        echo "$line" >> "$CONFIG_FILE"
        echo "✅ Appended in $CONFIG_FILE:"
        echo "$line"
    else
        echo "✅ Already exists in $CONFIG_FILE:"
        echo "$line"
    fi
}

# Run the checks
append_if_missing "$CIPHERS_LINE" "Disable Ciphers List"
append_if_missing "$MACS_LINE" "Enable MACs List"
        </code></pre>

        <pre><b>desktop_setup.sh:</b><code class="language-bash">
#!/bin/bash

# Exit if any command fails
set -e
# 🛑 Abort if running as root
if [ "$EUID" -eq 0 ]; then
  echo "❌ Don't run this script as root. Run it as a regular user."
  exit 1
fi

if ! command -v dbus-launch &> /dev/null
then
    echo "✅ dbus-launch not found. Installing dbus-x11..."
    sudo apt update
    sudo apt install -y dbus-x11
else
    echo "✅ dbus-launch is already installed."
fi

echo "Mimicing Windows Desktop Style"
gsettings set org.gnome.shell.extensions.dash-to-dock dock-position 'BOTTOM'
echo "✅ Dock moved to the bottom."
gsettings set org.gnome.shell.extensions.dash-to-dock show-apps-at-top true
gsettings set org.gnome.shell.extensions.dash-to-dock show-apps-always-in-the-edge true
echo "✅ App button moved to the left."
gsettings set org.gnome.shell.extensions.ding start-corner 'top-left'
gsettings set org.gnome.shell.extensions.ding arrangeorder 'NAME'
gsettings set org.gnome.shell.extensions.ding keep-arranged true
echo "✅ Desktop icon arranged to the top left."
gsettings set org.gnome.shell favorite-apps "['org.gnome.Nautilus.desktop', 'org.gnome.Terminal.desktop', 'firefox_firefox.desktop']"
echo "✅ Pinned Folder, Terminal, Browswer to the taskbar."

echo "Disable screen blanking on idle"
gsettings set org.gnome.desktop.session idle-delay 0
echo "✅ Screen blanking disabled."
        </code></pre>

        <pre><b>hostname_setup.sh:</b><code class="language-bash">
#!/bin/bash

# Exit if any command fails
set -e
# Ensure the script is run as root
if [ "$EUID" -ne 0 ]; then
  echo "❌ Please run as root or with sudo"
  exit 1
fi

# List of IP-hostname pairs
HOST_ENTRIES=(
  "192.168.1.100 bill01"
  "192.168.1.101 slave1"
  "192.168.1.102 slave2"
  "192.168.1.103 slave3"
  "192.168.1.104 slave4"
  "192.168.1.105 slave5"
  "192.168.1.106 master"
)

echo "🔍 Checking /etc/hosts for existing entries..."

for entry in "${HOST_ENTRIES[@]}"; do
  if ! grep -Fqx "$entry" /etc/hosts; then
    echo "$entry" >> /etc/hosts
    echo "➕ Added: $entry"
  else
    echo "✅ Already exists: $entry"
  fi
done

echo "🚀 Host entries update complete!"
        </code></pre>
      </section>
    </main>
    <!-- custom script -->
    <script src="script/script.js"></script>
  </body>
</html>
